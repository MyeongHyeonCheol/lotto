import React, { useState } from 'react';
import './App.module.css';

function App() {
  const [myNumbers, setMyNumbers] = useState([]);
  const [manualSelection, setManualSelection] = useState([]);
  const [winningNumbers, setWinningNumbers] = useState([]);
  const [bonusNumber, setBonusNumber] = useState(null);
  const [mode, setMode] = useState('');
  const min = 1;
  const max = 45;

  const generateUniqueNumbers = (count, exclude = []) => {
    const numbers = [];
    while (numbers.length < count) {
      const randomNumber = Math.floor(Math.random() * (max - min + 1)) + min;
      if (!numbers.includes(randomNumber) && !exclude.includes(randomNumber)) {
        numbers.push(randomNumber);
      }
    }
    return numbers;
  };

  const getWinningNumbers = () => {
    const mainNumbers = generateUniqueNumbers(6);
    setWinningNumbers(mainNumbers);
    const bonus = generateUniqueNumbers(1, mainNumbers)[0];
    setBonusNumber(bonus);
  };

  const getMyNumbers = () => {
    const myNums = generateUniqueNumbers(6);
    setMyNumbers(myNums);
  };

  const getResultMessage = () => {
    if (myNumbers.length !== 6 || winningNumbers.length !== 6) {
      return null;
    }
    const matchCount = myNumbers.filter(num => winningNumbers.includes(num)).length;
    const hasBonus = myNumbers.includes(bonusNumber);

    if (matchCount === 6) return 'ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! 1ë“±ì…ë‹ˆë‹¤! ğŸ‰';
    if (matchCount === 5 && hasBonus) return 'ğŸ¥³ ì¶•í•˜í•©ë‹ˆë‹¤! 2ë“±ì…ë‹ˆë‹¤!';
    if (matchCount === 5) return 'ğŸŠ ì¶•í•˜í•©ë‹ˆë‹¤! 3ë“±ì…ë‹ˆë‹¤!';
    if (matchCount === 4) return 'ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! 4ë“±ì…ë‹ˆë‹¤!';
    if (matchCount === 3) return 'ğŸ‘ ì¶•í•˜í•©ë‹ˆë‹¤! 5ë“±ì…ë‹ˆë‹¤!';
    return 'ğŸ˜¢ ì•„ì‰½ì§€ë§Œ ë‹¤ìŒ ê¸°íšŒì—!';
  };

  const handleManualSelect = (num) => {
    if (manualSelection.includes(num) || manualSelection.length >= 6) return;
    const updated = [...manualSelection, num];
    setManualSelection(updated);
    if (mode === 'manual' && updated.length === 6) setMyNumbers(updated);
  };

  const fillRemainingForSemiAuto = () => {
    if (manualSelection.length === 0) return alert('ë¨¼ì € ë²ˆí˜¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
    const remainingCount = 6 - manualSelection.length;
    const autoGenerated = generateUniqueNumbers(remainingCount, manualSelection);
    const finalNumbers = [...manualSelection, ...autoGenerated];
    setMyNumbers(finalNumbers);
  };

  const resetManual = () => {
    setManualSelection([]);
    setMyNumbers([]);
  };

  return (
    <div className="container">
      <h1 className="title">ğŸ° LOTTO SIMULATION ğŸ°</h1>
      <hr />

      <div className="section">
        <label>ë°©ì‹ì„ ì„ íƒí•´ì£¼ì„¸ìš”!
          <select
            className="dropdown"
            value={mode}
            onChange={(e) => {
              setMode(e.target.value);
              resetManual();
            }}
          >
            <option value="auto">ìë™</option>
            <option value="manual">ìˆ˜ë™</option>
            <option value="semi">ë°˜ìë™</option>
          </select>
        </label>
      </div>

      <div className="section">
        <h2>ë‚´ ë²ˆí˜¸</h2>
        <div className="numbers">{myNumbers.join(', ')}</div>

        {mode === 'auto' && <button className="button" onClick={getMyNumbers}>ë²ˆí˜¸ ìƒì„±</button>}

        {(mode === 'manual' || mode === 'semi') && (
          <div>
            <div className="number-grid">
              {Array.from({ length: max }, (_, i) => i + 1).map(num => (
                <button
                  key={num}
                  onClick={() => handleManualSelect(num)}
                  disabled={manualSelection.includes(num)}
                  className={`number-button ${manualSelection.includes(num) ? 'selected' : ''}`}
                >
                  {num}
                </button>
              ))}
            </div>

            <div>ì„ íƒí•œ ë²ˆí˜¸: {manualSelection.join(', ')}</div>

            {mode === 'manual' && manualSelection.length === 6 && (
              <div className="complete">âœ… ë²ˆí˜¸ ì„ íƒ ì™„ë£Œ!</div>
            )}

            {mode === 'semi' && (
              <button 
                className="button" 
                onClick={fillRemainingForSemiAuto} 
                disabled={manualSelection.length > 6}
              >
                ë²ˆí˜¸ ìƒì„±
              </button>
            )}
          </div>
        )}
      </div>

      <div className="section">
        <h2>ë‹¹ì²¨ ë²ˆí˜¸</h2>
        <div className="numbers">{winningNumbers.join(', ')}</div>
        <div className="bonus">ë³´ë„ˆìŠ¤ ë²ˆí˜¸: {bonusNumber !== null ? bonusNumber : '-'}</div>
        <button className="button" onClick={getWinningNumbers}>ì¶”ì²¨ ì‹œì‘!</button>
      </div>

      <div className="section">
        <h2>ê²°ê³¼</h2>
        <div>
          {myNumbers.length > 0 && winningNumbers.length > 0
            ? `ë‹¹ì²¨ëœ ë²ˆí˜¸: ${myNumbers.filter(num => winningNumbers.includes(num)).join(', ')}`
            : 'ë²ˆí˜¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”!'}
        </div>
        <div className="result-message">{getResultMessage()}</div>
      </div>
    </div>
  );
}

export default App;
